Index: workflow.cwl
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>#!/usr/bin/env cwl-runner\n\ncwlVersion: v1.0\nclass: Workflow\nlabel: <YOUR CHALLENGE> Evaluation\ndoc: >\n  BRIEF DESCRIPTION ABOUT THE CHALLENGE, e.g.\n  This workflow will run and evaluate Docker submissions to the\n  Awesome Challenge (syn123). Metrics returned are x, y, z.\n\nrequirements:\n  - class: StepInputExpressionRequirement\n\ninputs:\n  adminUploadSynId:\n    label: Synapse Folder ID accessible by an admin\n    type: string\n  submissionId:\n    label: Submission ID\n    type: int\n  submitterUploadSynId:\n    label: Synapse Folder ID accessible by the submitter\n    type: string\n  synapseConfig:\n    label: filepath to .synapseConfig file\n    type: File\n  workflowSynapseId:\n    label: Synapse File ID that links to the workflow\n    type: string\n\noutputs: {}\n\nsteps:\n\n  get_docker_submission:\n    run: https://raw.githubusercontent.com/Sage-Bionetworks/ChallengeWorkflowTemplates/v3.1/cwl/get_submission.cwl\n    in:\n      - id: submissionid\n        source: \"#submissionId\"\n      - id: synapse_config\n        source: \"#synapseConfig\"\n    out:\n      - id: filepath\n      - id: docker_repository\n      - id: docker_digest\n      - id: entity_id\n      - id: entity_type\n      - id: results\n\n  get_docker_config:\n    run: https://raw.githubusercontent.com/Sage-Bionetworks/ChallengeWorkflowTemplates/v3.1/cwl/get_docker_config.cwl\n    in:\n      - id: synapse_config\n        source: \"#synapseConfig\"\n    out: \n      - id: docker_registry\n      - id: docker_authentication\n\n  download_goldstandard:\n    run: https://raw.githubusercontent.com/Sage-Bionetworks-Workflows/cwl-tool-synapseclient/v1.4/cwl/synapse-get-tool.cwl\n    in:\n      # TODO: replace `valueFrom` with the Synapse ID to the challenge goldstandard\n      - id: synapseid\n        valueFrom: \"syn58577285\"\n      - id: synapse_config\n        source: \"#synapseConfig\"\n    out:\n      - id: filepath\n\n  validate_docker:\n    run: https://raw.githubusercontent.com/Sage-Bionetworks/ChallengeWorkflowTemplates/v3.1/cwl/validate_docker.cwl\n    in:\n      - id: submissionid\n        source: \"#submissionId\"\n      - id: synapse_config\n        source: \"#synapseConfig\"\n    out:\n      - id: results\n      - id: status\n      - id: invalid_reasons\n\n  email_docker_validation:\n    run: https://raw.githubusercontent.com/Sage-Bionetworks/ChallengeWorkflowTemplates/v3.1/cwl/validate_email.cwl\n    in:\n      - id: submissionid\n        source: \"#submissionId\"\n      - id: synapse_config\n        source: \"#synapseConfig\"\n      - id: status\n        source: \"#validate_docker/status\"\n      - id: invalid_reasons\n        source: \"#validate_docker/invalid_reasons\"\n      # OPTIONAL: set `default` to `false` if email notification about valid submission is needed\n      - id: errors_only\n        default: true\n    out: [finished]\n\n  annotate_docker_validation_with_output:\n    run: https://raw.githubusercontent.com/Sage-Bionetworks/ChallengeWorkflowTemplates/v3.1/cwl/annotate_submission.cwl\n    in:\n      - id: submissionid\n        source: \"#submissionId\"\n      - id: annotation_values\n        source: \"#validate_docker/results\"\n      - id: to_public\n        default: true\n      - id: force\n        default: true\n      - id: synapse_config\n        source: \"#synapseConfig\"\n    out: [finished]\n\n  check_docker_status:\n    run: https://raw.githubusercontent.com/Sage-Bionetworks/ChallengeWorkflowTemplates/v3.1/cwl/check_status.cwl\n    in:\n      - id: status\n        source: \"#validate_docker/status\"\n      - id: previous_annotation_finished\n        source: \"#annotate_docker_validation_with_output/finished\"\n      - id: previous_email_finished\n        source: \"#email_docker_validation/finished\"\n    out: [finished]\n\n  run_docker:\n    run: steps/run_docker.cwl\n    in:\n      - id: docker_repository\n        source: \"#get_docker_submission/docker_repository\"\n      - id: docker_digest\n        source: \"#get_docker_submission/docker_digest\"\n      - id: submissionid\n        source: \"#submissionId\"\n      - id: docker_registry\n        source: \"#get_docker_config/docker_registry\"\n      - id: docker_authentication\n        source: \"#get_docker_config/docker_authentication\"\n      - id: status\n        source: \"#validate_docker/status\"\n      - id: parentid\n        source: \"#submitterUploadSynId\"\n      - id: synapse_config\n        source: \"#synapseConfig\"\n      # OPTIONAL: set `default` to `false` if log file should not be uploaded to Synapse\n      - id: store\n        default: true\n      # TODO: replace `valueFrom` with the absolute path to the data directory to be mounted\n      - id: input_dir\n        valueFrom: \"/tmp\"\n      - id: docker_script\n        default:\n          class: File\n          location: \"run_docker.py\"\n    out:\n      - id: predictions\n\n  upload_results:\n    run: https://raw.githubusercontent.com/Sage-Bionetworks/ChallengeWorkflowTemplates/v3.1/cwl/upload_to_synapse.cwl\n    in:\n      - id: infile\n        source: \"#run_docker/predictions\"\n      - id: parentid\n        source: \"#adminUploadSynId\"\n      - id: used_entity\n        source: \"#get_docker_submission/entity_id\"\n      - id: executed_entity\n        source: \"#workflowSynapseId\"\n      - id: synapse_config\n        source: \"#synapseConfig\"\n    out:\n      - id: uploaded_fileid\n      - id: uploaded_file_version\n      - id: results\n\n  annotate_docker_upload_results:\n    run: https://raw.githubusercontent.com/Sage-Bionetworks/ChallengeWorkflowTemplates/v3.1/cwl/annotate_submission.cwl\n    in:\n      - id: submissionid\n        source: \"#submissionId\"\n      - id: annotation_values\n        source: \"#upload_results/results\"\n      - id: to_public\n        default: true\n      - id: force\n        default: true\n      - id: synapse_config\n        source: \"#synapseConfig\"\n      - id: previous_annotation_finished\n        source: \"#annotate_docker_validation_with_output/finished\"\n    out: [finished]\n\n  validate:\n    run: steps/validate.cwl\n    in:\n      - id: input_file\n        source: \"#run_docker/predictions\"\n      - id: entity_type\n        source: \"#get_docker_submission/entity_type\"\n    out:\n      - id: results\n      - id: status\n      - id: invalid_reasons\n  \n  email_validation:\n    run: https://raw.githubusercontent.com/Sage-Bionetworks/ChallengeWorkflowTemplates/v3.1/cwl/validate_email.cwl\n    in:\n      - id: submissionid\n        source: \"#submissionId\"\n      - id: synapse_config\n        source: \"#synapseConfig\"\n      - id: status\n        source: \"#validate/status\"\n      - id: invalid_reasons\n        source: \"#validate/invalid_reasons\"\n      # OPTIONAL: set `default` to `false` if email notification about valid submission is needed\n      - id: errors_only\n        default: true\n    out: [finished]\n\n  annotate_validation_with_output:\n    run: https://raw.githubusercontent.com/Sage-Bionetworks/ChallengeWorkflowTemplates/v3.1/cwl/annotate_submission.cwl\n    in:\n      - id: submissionid\n        source: \"#submissionId\"\n      - id: annotation_values\n        source: \"#validate/results\"\n      - id: to_public\n        default: true\n      - id: force\n        default: true\n      - id: synapse_config\n        source: \"#synapseConfig\"\n      - id: previous_annotation_finished\n        source: \"#annotate_docker_upload_results/finished\"\n    out: [finished]\n\n  check_status:\n    run: https://raw.githubusercontent.com/Sage-Bionetworks/ChallengeWorkflowTemplates/v3.1/cwl/check_status.cwl\n    in:\n      - id: status\n        source: \"#validate/status\"\n      - id: previous_annotation_finished\n        source: \"#annotate_validation_with_output/finished\"\n      - id: previous_email_finished\n        source: \"#email_validation/finished\"\n    out: [finished]\n\n  score:\n    run: steps/score.cwl\n    in:\n      - id: input_file\n        source: \"#run_docker/predictions\"\n      - id: goldstandard\n        source: \"#download_goldstandard/filepath\"\n      - id: check_validation_finished \n        source: \"#check_status/finished\"\n    out:\n      - id: results\n      \n  email_score:\n    run: https://raw.githubusercontent.com/Sage-Bionetworks/ChallengeWorkflowTemplates/v3.1/cwl/score_email.cwl\n    in:\n      - id: submissionid\n        source: \"#submissionId\"\n      - id: synapse_config\n        source: \"#synapseConfig\"\n      - id: results\n        source: \"#score/results\"\n      # OPTIONAL: add annotations to be withheld from participants to `[]`\n      # - id: private_annotations\n      #   default: []\n    out: []\n\n  annotate_submission_with_output:\n    run: https://raw.githubusercontent.com/Sage-Bionetworks/ChallengeWorkflowTemplates/v3.1/cwl/annotate_submission.cwl\n    in:\n      - id: submissionid\n        source: \"#submissionId\"\n      - id: annotation_values\n        source: \"#score/results\"\n      - id: to_public\n        default: true\n      - id: force\n        default: true\n      - id: synapse_config\n        source: \"#synapseConfig\"\n      - id: previous_annotation_finished\n        source: \"#annotate_validation_with_output/finished\"\n    out: [finished]\n \n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/workflow.cwl b/workflow.cwl
--- a/workflow.cwl	(revision 35efc9fe4ffa5cef76b89f77289ae888cdb75e9f)
+++ b/workflow.cwl	(date 1713886184180)
@@ -32,6 +32,34 @@
 
 steps:
 
+  set_submitter_folder_permissions:
+    run: https://raw.githubusercontent.com/Sage-Bionetworks/ChallengeWorkflowTemplates/v3.1/cwl/set_permissions.cwl
+    in:
+      - id: entityid
+        source: "#submitterUploadSynId"
+      # TODO: replace `valueFrom` with the admin user ID or admin team ID
+      - id: principalid
+        valueFrom: "3500740"
+      - id: permissions
+        valueFrom: "download"
+      - id: synapse_config
+        source: "#synapseConfig"
+    out: []
+
+  set_admin_folder_permissions:
+    run: https://raw.githubusercontent.com/Sage-Bionetworks/ChallengeWorkflowTemplates/v3.1/cwl/set_permissions.cwl
+    in:
+      - id: entityid
+        source: "#adminUploadSynId"
+      # TODO: replace `valueFrom` with the admin user ID or admin team ID
+      - id: principalid
+        valueFrom: "3500740"
+      - id: permissions
+        valueFrom: "download"
+      - id: synapse_config
+        source: "#synapseConfig"
+    out: []
+
   get_docker_submission:
     run: https://raw.githubusercontent.com/Sage-Bionetworks/ChallengeWorkflowTemplates/v3.1/cwl/get_submission.cwl
     in:
@@ -61,7 +89,7 @@
     in:
       # TODO: replace `valueFrom` with the Synapse ID to the challenge goldstandard
       - id: synapseid
-        valueFrom: "syn58577285"
+        valueFrom: "58577285"
       - id: synapse_config
         source: "#synapseConfig"
     out:
